# apiVersion: resources.azure.com/v1alpha1api20200601
# kind: ResourceGroup
# metadata:
#   name: cool-website-rg
# spec:
#   azureName: cosmos-tood-app-rg-dev
# ---
# apiVersion: storage.azure.com/v1alpha1api20210401
# kind: StorageAccount
# metadata:
#   name: coolstorageaso
# spec:
#   azureName: coolstorageasodev
# ---
# apiVersion: cache.azure.com/v1alpha1api20201201
# kind: Redis
# metadata:
#   name: coolredis
# spec:
#   azureName: coolredisdev
# ---
apiVersion: documentdb.azure.com/v1api20210515
kind: SqlRoleAssignment
metadata:
  name: cosmos-todo-app-role-assignment
  namespace: cosmos-todo
spec:
  # This RoleDefinition corresponds to "Cosmos DB Built-in Data Contributor". See https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-setup-rbac#built-in-role-definitions for more.
  roleDefinitionId: /subscriptions/82acd5bb-4206-47d4-9c12-a65db028483d/resourceGroups/cosmos-todo-app-rg-dev/providers/Microsoft.DocumentDB/databaseAccounts/cosmos-todo-app-sqldb/sqlRoleDefinitions/00000000-0000-0000-0000-000000000002
  scope: /subscriptions/82acd5bb-4206-47d4-9c12-a65db028483d/resourceGroups/cosmos-todo-app-rg-dev/providers/Microsoft.DocumentDB/databaseAccounts/cosmos-todo-app-sqldb
---
apiVersion: managedidentity.azure.com/v1api20220131preview
kind: FederatedIdentityCredential
metadata:
  name: cosmos-todo-app-fic
  namespace: cosmos-todo
spec:
  # For Workload Identity, Issuer should be the OIDC endpoint of the cluster. For AKS this will look like
  # https://oidc.prod-aks.azure.com/00000000-0000-0000-0000-00000000000/
  issuer: https://eastus.oic.prod-aks.azure.com/72f988bf-86f1-41af-91ab-2d7cd011db47/f4d32229-0647-4825-8460-2baf8d8dcd2a/
  # For Workload Identity, Subject should always be system:serviceaccount:<namespace>:<serviceaccount>
  subject: system:serviceaccount:todo-dev:cosmos-service-account